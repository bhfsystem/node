#!/usr/bin/env bash

function bootstrap {
  local shome="$(cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"
  source "$shome/script/profile"

  local url_node

  case "$(uname -s)" in
    Darwin)
      url_node='https://nodejs.org/dist/v5.5.0/node-v5.5.0-darwin-x64.tar.gz'
      ;;
    Linux)
      url_node='https://nodejs.org/dist/v5.5.0/node-v5.5.0-linux-x64.tar.gz'
      ;;
  esac

  local tmp_node="$(mktemp -t XXXXXX)"
  trap "$(printf "rm -f '%q'" "$tmp_node")" EXIT
  curl -sS -L -o "$tmp_node" "$url_node"
  mkdir -p "$shome/vendor"
  tar xvfz "$tmp_node" -C vendor
  rm -f "$tmp_node"

  (set +f; cd vendor; ln -nfs node-v5.5.0-* node)
}

bootstrap
